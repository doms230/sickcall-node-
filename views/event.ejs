<!DOCTYPE html>
<html lang ="en">
<head>
    <title> Hiikey </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <!-- Parse SDK -->
    <script src="//www.parsecdn.com/js/parse-1.6.14.min.js"></script>

    <!-- Stripe SDK   <script type="text/javascript" src="https://js.stripe.com/v2/"></script>  -->

    <!-- <script type="text/javascript" src="https://js.stripe.com/v2/"></script> -->
    <script src="https://checkout.stripe.com/checkout.js"></script>

    <!--Ajax -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

</head>
<body>

<nav class="navbar navbar-default ">
    <div class="container-fluid">
        <div class="navbar-header">
            <p class="navbar-text"><%=user%></p>
            <a href="events/auth/facebook" class="btn btn-default navbar-btn"><span class="fa fa-twitter"></span><%=logButton%></a>

        </div>
    </div>
</nav>

<div class="container-fluid">

    <div class="page-header">
        <h1><%= title %><small><%= date %></small></h1>
    </div>

    <div class="row">

        <div class= "col-md-4">
            <h4>Tickets</h4>

            <table class="table table-striped">
                <thead>
                <tr>
                    <th> Name</th>
                    <th>Price</th>
                    <th>Quantity</th>
                </tr>
                </thead>

                <tbody>

                <tr>
                    <td><%= ticketName0 %></td>
                    <td><%=ticketPrice0%></td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group" aria-label="...">
                            <input type="button" class="btn btn-primary disabled" name="TextBox" id="quan0" value="0" />
                            <input type="Button" class="btn btn-default" id='minusButton0' value="-"/>
                            <input type="Button" class="btn btn-default" id='addButton0' value="+"/>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td><%=ticketName1%></td>
                    <td><%=ticketPrice1%></td>
                    <td><div class="btn-group btn-group-sm" role="group" aria-label="...">
                            <input type="button" class="btn btn-primary disabled" name="TextBox" id="quan1" value="0" />
                            <input type="Button" class="btn btn-default" id='minusButton1' value="-"/>
                            <input type="Button" class="btn btn-default" id='addButton1' value="+"/>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td><%=ticketName2%></td>
                    <td><%=ticketPrice2%></td>
                    <td><div class="btn-group btn-group-sm" role="group" aria-label="...">
                            <input type="button" class="btn btn-primary disabled" name="TextBox" id="quan2" value="0" />
                            <input type="Button" class="btn btn-default" id='minusButton2' value="-"/>
                            <input type="Button" class="btn btn-default" id='addButton2' value="+"/>
                        </div>

                    </td>
                </tr>
                </tbody>
            </table>

            <h6>Total: <span id="total_price"></span></h6>

            <a href="#" id="pay" class="btn btn-default "><span class="fa fa-twitter"></span>Checkout</a>

            <script >

                function changeQuantity(quan, addButton, minusButton) {
                    var counter = quan.val();

                    addButton.click(function () {

                        if (counter != 5) {
                            counter++;
                            quan.prop('value', counter);
                        }
                    });

                    minusButton.click(function () {

                        if (counter != 0) {
                            counter -= 1;
                            // quan.val(counter)
                            quan.prop('value', counter);
                        }
                    });
                }

                changeQuantity($('#quan0'),$('#addButton0'),$('#minusButton0'))
                changeQuantity($('#quan1'),$('#addButton1'),$('#minusButton1'));
                changeQuantity($('#quan2'),$('#addButton2'),$('#minusButton2'));

                // Define handler to be called when Stripe returns a card token
                function onReceiveToken(token, args) {

                    var buyTickets = $.post('/payments/buyTickets', {
                        stripeToken: token.id,
                        amount: 5000,
                        destination: "acct_180hDGJLoSMNpJp1"
                    });

                    buyTickets.done(function(data){
                        alert( "Data Loaded: " + data.id );
                    });
                }

                // Configure Checkout
                var checkout = StripeCheckout.configure({
                    key: 'pk_test_wMPl893ju7D1tv3DUO6CRCBh',
                    token: onReceiveToken,
                    amount: 5000,
                    name: "" ,
                    description: "asdf",
                    zipCode: "true",
                    allowRememberMe: false,
                    locale: 'auto'
                });

                // Open Checkout when the link is clicked
                $('#pay').on('click', function() {
                    checkout.open();
                    return false;
                });

            </script>

        </div>
        <div class="col-md-8">
            <%= description %>
            <img src=<%= image %> class="img-thumbnail" alt="Responsive image">
        </div>
    </div>
</div>
</body>
</html>